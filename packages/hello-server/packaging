#!/bin/bash -eu

# "I am GOROOT"
export GOROOT=$(readlink -nf /var/vcap/packages/golang-1.16-linux)
export PATH="${GOROOT}/bin:$PATH"

# For debugging porpoises
go env
ls -la

# This is for use of Go modules.
export GOCACHE=/var/vcap/data/golang-1.16-linu/cache
mkdir -p "${GOCACHE}"

# Setup GOPATH (required to run Go build)
export TEMPORARY_GOPATH="${PWD}/tmp"
mkdir -p "${TEMPORARY_GOPATH}"
export GOPATH="${TEMPORARY_GOPATH}"
export GOBIN="${GOPATH}/bin"
export PATH="${GOBIN}:${PATH}"

export GOFLAGS=-mod=vendor
export CGO_ENABLED=0

go build -o hello-server ./cmd/hello-server

cp hello-server "${BOSH_INSTALL_TARGET}"